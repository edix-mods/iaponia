#
# remember to add graphics for relevant ones when you add to this
#
# if a modifier is scaled, its multiplied with development in the province.


# any_friendly_coast_border_province is a special scope made for institution spread.
# It checks for adjacent provinces or provinces one seazone away.
# Friendly is defined as at positive relations or owned by the same country that owns the province.

#######################################
# Sominrigaku
#######################################

sominrigaku_i = {
	bonus = {
		advisor_pool = 1
	}


	history = {
		is_year = 1300
		OR = {
			AND = {
				region = hokkaido_region
				NOT = {
					province_id = 607
				}
				is_year = 1600
			}
		}
	}

	#Available from start
	#can_start = {	is_year = 1000	}
	#start_chance = 100
	#on_start = institution_events.1

	can_embrace = {
		always = yes
	}

	embracement_speed = {
		modifier = {
			factor = 0.5
			scale = yes
			custom_trigger_tooltip = {
				tooltip = FRIENDLY_NEIGHBOR_OR_COAST_PROVINCE_HAS_EMBRACED
				any_friendly_coast_border_province = {
					sominrigaku_i = 100
				}
			}
		}
		modifier = {
			factor = 1
			scale = yes
			potential = {
				owner = {
					has_institution = sominrigaku_i
				}
			}
			custom_trigger_tooltip = {
				tooltip = tooltip_sominrigaku_embraced
				owner = {
					has_institution = sominrigaku_i
				}
			}
		}
	}

	ai_will_do = { #Cost of embracing institution must be lower than this factor * last month's regular income, and higher if loans are needed. (Or it has a more than long term goal...)
		factor = 30

		modifier = {
			factor = 0.25
			is_at_war = yes
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.1
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.2
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.3
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.4
		}
	}
}

#######################################
# Higashiyama Culture
#
# Flows from Kyoto and Little Kyotos
#######################################

higashiyama_culture_i = {

	bonus = {
		development_cost = -0.1
		advisor_cost = -0.1
	}


	historical_start_date = 1478.1.1 #End of the Onin War
	historical_start_province = 683 #Kyoto

	history = {
		OR = {
			AND = {
				OR = {
					province_id = 107 #Nakamura
					province_id = 113 #Yamaguchi
					province_id = 388 #Ichijodani
					province_id = 430 #Sunpu
					province_id = 493 #Ashikaga
					province_id = 683 #Kyoto
				}
				is_year = 1477
			}
			is_year = 1530
		}
	}

	#Available from start
	#can_start = {	is_year = 1480	}
	#start_chance = 100
	#on_start = institution_events.2

	can_embrace = {
		owner = { has_institution = sominrigaku_i }
	}



	embracement_speed = {
		modifier = {
			scale = yes
			factor = 0.3
			custom_trigger_tooltip = {
				tooltip = tooltip_any_friendly_coast_border_province_has_embraced_higashiyama
				any_friendly_coast_border_province = {
					higashiyama_culture_i = 100
				}
			}
		}
		modifier = {
			factor = 0.1
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_development_10
				development = 10
			}
		}
		modifier = {
			factor = 0.25
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_development_20
				development = 20
			}
		}
		modifier = {
			factor = 0.1
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_tea
				trade_goods = tea
			}
		}
		modifier = {
			factor = 0.1
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_paper
				trade_goods = paper
			}
		}
		modifier = {
			factor = 0.25
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_garden
				has_building = garden
			}
		}
		modifier = {
			factor = 0.25
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_tea_retreat
				has_building = tea_retreat
			}
		}
		modifier = {
			factor = 0.5
			custom_trigger_tooltip = {
				tooltip = tooltip_higashiyama_advisor
				is_capital = yes
				owner = {
					OR = {
						advisor = tea_master_a
						advisor = poet_a
					}
				}
			}
		}
		modifier = {
			factor = 1
			custom_trigger_tooltip = {
				tooltip = tooltip_full_patronage
				is_capital = yes
				owner = {
					full_idea_group = patronage_ideas
				}
			}
		}
		modifier = {
			factor = 1
			potential = {
				region = kansai_region
			}
			custom_trigger_tooltip = {
				tooltip = tooltip_capital_culture
				is_capital = yes
				region = kansai_region
			}
		}
	}

	ai_will_do = { #Cost of embracing institution must be lower than this factor * last month's regular income, and higher if loans are needed. (Or it has a more than long term goal...)
		factor = 24

		modifier = {
			factor = 0.25
			is_at_war = yes
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.1
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.2
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.3
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.4
		}
	}
}

#######################################
# Gekokujo
#######################################
#tie government reforms into modifiers and requirements
gekokujo_i = {

	bonus = {
		free_leader_pool = 1
		#second modifier here for when we add in special regiments
	}

	historical_start_date = 1507.1.1 #Yoshioki Ouchi marches to Kyoto
	historical_start_province = 451 #Odawara

	history = {
		OR = {
			AND = {
				is_year = 1510
				OR = {
					region = kansai_region
					region = kanto_region
				}
			}
			AND = {
				is_year = 1520
				OR = {
					region = chubu_region
					region = chugoku_region
					region = shikoku_region
					region = kanto_region
					region = kyushu_region
					region = tohoku_region
				}
			}
			is_year = 1530
		}
	}

	can_start = {
		is_capital = yes
		is_year = 1510
	}
	start_chance = 5		#in 100 for when a province can_start


	on_start = institution_events.3


	can_embrace = {
		always = yes
	}


	embracement_speed = {

		modifier = {
			scale = yes
			factor = 0.5
			custom_trigger_tooltip = {
				tooltip = tooltip_any_friendly_coast_border_province_has_embraced_gekokujo
				any_friendly_coast_border_province = {
					gekokujo_i = 100
				}
			}
		}
		modifier = {
			factor = 0.5
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_fortified_mansion
				has_building = fortified_mansion
			}
		}
		modifier = {
			factor = 0.5
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_layered_enclosures
				has_building = layered_enclosures
			}
		}
		modifier = {
			factor = 0.5
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_main_keep
				has_building = main_keep
			}
		}
		modifier = {
			factor = 0.5
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_fortress
				has_building = fortress
			}
		}
		modifier = {
			factor = 1
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_ikko_ikki
				religion = ikko_shu
			}
		}
	}

	ai_will_do = { #Cost of embracing institution must be lower than this factor * last month's regular income, and higher if loans are needed. (Or it has a more than long term goal...)
		factor = 24

		modifier = {
			factor = 0.25
			is_at_war = yes
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.1
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.2
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.3
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.4
		}
	}
}

#######################################
# Gunsmithing
#######################################
gunsmithing_i = {

	bonus = {
		land_forcelimit_modifier = 0.1
		backrow_artillery_damage = 0.1
	}


	historical_start_date = 1544.9.1 # First Kunitomo Muskets are produced
	historical_start_province = 333 # Sakata

	history = {
		OR = {
			AND = {
				is_year = 1550
				OR = {
				region = kansai_region
				region = kyushu_region
				}
			}
			AND = {
				OR = {
					region = chubu_region
					region = chugoku_region
					region = shikoku_region
					region = kanto_region
					region = tohoku_region
				}
				is_year = 1570
			}
			is_year = 1590
		}
	}

	can_start = {
		is_year = 1550
		trade_goods = firearms
		region = kansai_region
		OR = {
			province_has_center_of_trade_of_level = 4
			province_has_center_of_trade_of_level = 3
		}
	}
	start_chance = 5		#in 100 for when a province can_start


	on_start = institution_events.4


	can_embrace = {
		always = yes
	}


	embracement_speed = {

		modifier = {
			scale = yes
			factor = 0.5
			custom_trigger_tooltip = {
				tooltip = tooltip_any_friendly_coast_border_province_has_embraced_gunsmithing
				any_friendly_coast_border_province = {
					gunsmithing_i = 100
				}
			}
		}
		modifier = {
			factor = 0.5
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_arsenal
				has_building = arsenal
			}
		}
		modifier = {
			factor = 0.25
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_temple_complex
				has_building = temple_complex
			}
		}
		modifier = {
			factor = 1
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_firearms
				trade_goods = firearms
			}
		}
		modifier = {
			factor = 0.5
			scale = yes
			potential = {
				owner = {
					has_institution = nanban_trade_i
				}
			}
			custom_trigger_tooltip = {
				tooltip = tooltip_global_trade_i_embraced
				owner = {
					has_institution = nanban_trade_i
				}
			}
		}
	}

	ai_will_do = { #Cost of embracing institution must be lower than this factor * last month's regular income, and higher if loans are needed. (Or it has a more than long term goal...)
		factor = 24

		modifier = {
			factor = 0.25
			is_at_war = yes
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.1
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.2
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.3
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.4
		}
	}
}

#######################################
# Nanban Trade
#######################################
nanban_trade_i = {

	bonus = {
		idea_cost = -0.1
		global_trade_goods_size_modifier = 0.1
	}


	historical_start_date = 1562.7.1 #Portuguese arrive in Yokosuera
	historical_start_province = 48 # Sonoki

	history = {
		OR = {
			AND = {
				is_year = 1560
				OR = {
					province_id = 9
					province_id = 40
					province_id = 48
					province_id = 64
					province_id = 94
					province_id = 113
					province_id = 277
					province_id = 704
				}
			}
			AND = {
				OR = {
					region = kansai_region
					region = kyushu_region
				}
				is_year = 1570
			}
			AND = {
				OR = {
					region = chubu_region
					region = chugoku_region
					region = shikoku_region
					region = kanto_region
					region = tohoku_region
				}
				is_year = 1580
			}
			is_year = 1590
		}
	}

	can_start = {
		has_port = yes
		OR = {
			province_has_center_of_trade_of_level = 4
			province_has_center_of_trade_of_level = 3
		}
	}
	
	start_chance = 5		#in 100 for when a province can_start


	on_start = institution_events.5


	can_embrace = {
		always = yes
	}


	embracement_speed = {

		modifier = {
			scale = yes
			factor = 0.25
			custom_trigger_tooltip = {
				tooltip = tooltip_any_friendly_coast_border_province_has_embraced_nanban_trade
				any_friendly_coast_border_province = {
					nanban_trade_i = 100
				}
			}
		}
		modifier = {
			factor = 0.1
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_merchant_guild
				has_building = merchant_guild
			}
		}
		modifier = {
			factor = 0.25
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_free_market
				has_building = free_market
			}
		}
		modifier = {
			factor = 0.1
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_harbor
				has_building = harbor
			}
		}
		modifier = {
			factor = 0.25
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_port_town
				has_building = port_town
			}
		}
		modifier = {
			factor = 1
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_catholic
				religion = kirishitan
			}
		}
		modifier = {
			factor = 0.5
			scale = yes
			potential = {
				OR = {
					province_has_center_of_trade_of_level = 2
					province_has_center_of_trade_of_level = 3
					province_has_center_of_trade_of_level = 4
				}
			}
			custom_trigger_tooltip = {
				tooltip = tooltip_center_of_trade_spread
				OR = {
					province_has_center_of_trade_of_level = 2
					province_has_center_of_trade_of_level = 3
					province_has_center_of_trade_of_level = 4
				}
			}
		}
		modifier = {
			factor = 1
			custom_trigger_tooltip = {
				tooltip = tooltip_full_mercantile
				is_capital = yes
				owner = {
					full_idea_group = mercantile_ideas
				}
			}
		}
	}

	ai_will_do = { #Cost of embracing institution must be lower than this factor * last month's regular income, and higher if loans are needed. (Or it has a more than long term goal...)
		factor = 24

		modifier = {
			factor = 0.25
			is_at_war = yes
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.1
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.2
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.3
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.4
		}
	}
}

#######################################
# Kokudaka System
#######################################
#tie into government reforms and absolutism
kokudaka_system_i = {

	bonus = {
		global_tax_modifier = 0.1
		culture_conversion_cost = -0.25
	}

	historical_start_date = 1582.6.27 #Kiyosu Conference, fiefs are redistributed and year of Hideyoshi's first land survey
	historical_start_province = 684 # Osaka

	history = {
		is_year = 1590
	}

	can_start = {
		is_year = 1580
		is_capital = yes
		development = 20
		higashiyama_culture_i = 100
		gekokujo_i = 100
	}

	start_chance = 5		#in 100 for when a province can_start


	on_start = institution_events.6


	can_embrace = {
		always = yes
	}


	embracement_speed = {
		modifier = {
			factor = 0.5
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_any_friendly_coast_border_province_has_embraced_kokudaka_system
				any_friendly_coast_border_province = {
					kokudaka_system_i = 100
				}
			}
		}
		modifier = {
			factor = 1
			custom_trigger_tooltip = {
				tooltip = tooltip_has_magistrate
				has_building = magistrate
			}
		}
		modifier = {
			factor = 0.1
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_has_rice
				trade_goods = rice
			}
		}
		modifier = {
			factor = 0.5
			custom_trigger_tooltip = {
				tooltip = tooltip_higashiyama_advisor
				is_capital = yes
				owner = {
					OR = {
						advisor = clan_elder_a
						advisor = magistrate_a
					}
				}
			}
		}
	}

	ai_will_do = { #Cost of embracing institution must be lower than this factor * last month's regular income, and higher if loans are needed. (Or it has a more than long term goal...)
		factor = 24

		modifier = {
			factor = 0.25
			is_at_war = yes
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.1
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.2
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.3
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.4
		}
	}
}

#######################################
# Rangaku
#######################################
rangaku_i = {

	bonus = {
		manpower_recovery_speed = 0.1
		technology_cost = -0.1
	}

	historical_start_date = 1634.1.1 # Construction of Dejima Begins
	historical_start_province = 534 # Musashi-Toshima

	history = {
		is_year = 1650
	}

	can_start = {
		is_year = 1630
		has_port = yes
		gunsmithing_i = 100
		nanban_trade_i = 100
		development = 20
		OR = {
			province_has_center_of_trade_of_level = 4
			province_has_center_of_trade_of_level = 3
		}
	}

	start_chance = 5		#in 100 for when a province can_start


	on_start = institution_events.7


	can_embrace = {
		always = yes
	}


	embracement_speed = {
		modifier = {
			factor = 0.1
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_any_friendly_coast_border_province_has_embraced_rangaku
				any_friendly_coast_border_province = {
					rangaku_i = 100
				}
			}
		}
		modifier = {
			factor = 0.5
			scale = yes
			custom_trigger_tooltip = {
				tooltip = tooltip_catholic
				religion = kirishitan
			}
		}
		modifier = {
			factor = 0.1
			scale = yes
			potential = {
				OR = {
					province_has_center_of_trade_of_level = 3
					province_has_center_of_trade_of_level = 4
				}
			}
			custom_trigger_tooltip = {
				tooltip = tooltip_center_of_trade_spread
				OR = {
					province_has_center_of_trade_of_level = 3
					province_has_center_of_trade_of_level = 4
				}
			}
		}
	}

	ai_will_do = { #Cost of embracing institution must be lower than this factor * last month's regular income, and higher if loans are needed. (Or it has a more than long term goal...)
		factor = 24

		modifier = {
			factor = 0.25
			is_at_war = yes
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.1
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.2
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.3
		}
		modifier = {
			factor = 2
			neighbors_tech_discount = 0.4
		}
	}
}
