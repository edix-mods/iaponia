#Estate Privilege on_action effects are in 01_scripted_effects_for_estates.txt

initialize_schools_effect = { #Used in on_startup on_action
}

#TODO: needs rewriting more carefully since it has events
battle_cult_spreading_effect = {
	#Kimun / Bear
	if = {
		limit = {
			ROOT = {
				religion = ainu
				NOT = { has_unlocked_cult = kimun_cult }
			}
			FROM = {
				religion = ainu
				has_unlocked_cult = kimun_cult
			}
		}
		ROOT = { country_event = { id = ainu_flavor.1 } }
	}
	if = {
		limit = {
			FROM = {
				religion = ainu
				NOT = { has_unlocked_cult = kimun_cult }
			}
			ROOT = {
				religion = ainu
				has_unlocked_cult = kimun_cult
			}
		}
		FROM = { country_event = { id = ainu_flavor.1 } }
	}
	#Fuchi / Owl
	if = {
		limit = {
			ROOT = {
				religion = ainu
				NOT = { has_unlocked_cult = fuchi_cult }
			}
			FROM = {
				religion = ainu
				has_unlocked_cult = fuchi_cult
			}
		}
		ROOT = { country_event = { id = ainu_flavor.2 } }
	}
	if = {
		limit = {
			FROM = {
				religion = ainu
				NOT = { has_unlocked_cult = fuchi_cult }
			}
			ROOT = {
				religion = ainu
				has_unlocked_cult = fuchi_cult
			}
		}
		FROM = { country_event = { id = ainu_flavor.2 } }
	}
	#Repun / Crab
	if = {
		limit = {
			ROOT = {
				religion = ainu
				NOT = { has_unlocked_cult = repun_cult }
			}
			FROM = {
				religion = ainu
				has_unlocked_cult = repun_cult
			}
		}
		ROOT = { country_event = { id = ainu_flavor.3 } }
	}
	if = {
		limit = {
			FROM = {
				religion = ainu
				NOT = { has_unlocked_cult = repun_cult }
			}
			ROOT = {
				religion = ainu
				has_unlocked_cult = repun_cult
			}
		}
		FROM = { country_event = { id = ainu_flavor.3 } }
	}
	
	#Christianity
	if = {
		limit = {
			ROOT = {
				NOT = { has_unlocked_cult = kirishitan_cult }
				religion = ainu
			}
			FROM = {
				OR = {
					religion = kirishitan
					has_unlocked_cult = kirishitan_cult
				}
			}
		}
		ROOT = { country_event = { id = ainu_flavor.4 } }
	}
	if = {
		limit = {
			FROM = {
				NOT = { has_unlocked_cult = kirishitan_cult }
				religion = ainu
			}
			ROOT = {
				OR = {
					has_unlocked_cult = kirishitan_cult
					religion = kirishitan
				}
			}
		}
		FROM = { country_event = { id = ainu_flavor.4 } }
	}

	#Buddhism
	if = {
		limit = {
			ROOT = {
				NOT = { has_unlocked_cult = buddhadharma_cult }
				religion = ainu
			}
			FROM = {
				OR = {
					religion = jodoshinshu
					religion = nichirenshu
					has_unlocked_cult = buddhadharma_cult
				}
			}
		}
		ROOT = { country_event = { id = ainu_flavor.5 } }
	}
	if = {
		limit = {
			FROM = {
				NOT = { has_unlocked_cult = buddhadharma_cult }
				religion = ainu
			}
			ROOT = {
				OR = {
					has_unlocked_cult = buddhadharma_cult
					religion = jodoshinshu
					religion = nichirenshu
				}
			}
		}
		FROM = { country_event = { id = ainu_flavor.5 } }
	}
	#Shinto Cult
	if = {
		limit = {
			ROOT = {
				NOT = { has_unlocked_cult = shinto_cult }
				religion = ainu
			}
			FROM = {
				OR = {
					religion = shinto
					has_unlocked_cult = shinto_cult
				}
			}
		}
		ROOT = { country_event = { id = ainu_flavor.6 } }
	}
	if = {
		limit = {
			FROM = {
				NOT = { has_unlocked_cult = shinto_cult }
				religion = ainu
			}
			ROOT = {
				OR = {
					has_unlocked_cult = shinto_cult
					religion = shinto
				}
			}
		}
		FROM = { country_event = { id = ainu_flavor.6 } }
	}
}

#FROM is previous state, owner has new state? interesting.
on_province_owner_change_government_effect = {
	if = {
		limit = {
			OR = {
				has_province_modifier = wine_bonus_prod
				has_province_modifier = grain_bonus_prod
			}
			FROM = { has_reform = monastic_breweries_reform }
			NOT = { owner = { has_reform = monastic_breweries_reform } }
		}
		remove_province_modifier = wine_bonus_prod
		remove_province_modifier = grain_bonus_prod
	}
	if = {
		limit = {
			NOT = {
				OR = {
					has_province_modifier = wine_bonus_prod
					has_province_modifier = grain_bonus_prod
				}
			}
			owner = { has_reform = monastic_breweries_reform }
			NOT = { FROM = { has_reform = monastic_breweries_reform } }
		}
		hidden_effect = {
			if = {
				limit = {
					trade_goods = wine
				}
				add_province_modifier = { 
					name = wine_bonus_prod
					duration = -1
					hidden = yes
				}
			}
			if = {
				limit = {
					trade_goods = grain
				}
				add_province_modifier = { 
					name = grain_bonus_prod
					duration = -1
					hidden = yes
				}
			}
		}
	}
	if = {
		limit = {
			has_province_modifier = naval_supplies_bonus_prod
			FROM = { has_government_attribute = extra_trade_goods_from_naval_supplies }
			NOT = { owner = { has_government_attribute = extra_trade_goods_from_naval_supplies } }
		}
		remove_province_modifier = naval_supplies_bonus_prod
	}
	if = {
		limit = {
			NOT = { has_province_modifier = naval_supplies_bonus_prod }
			owner = { has_government_attribute = extra_trade_goods_from_naval_supplies }
			NOT = { FROM = { has_government_attribute = extra_trade_goods_from_naval_supplies } }
		}
		hidden_effect = {
			if = {
				limit = {
					trade_goods = naval_supplies
				}
				add_province_modifier = { 
					name = naval_supplies_bonus_prod
					duration = -1
					hidden = yes
				}
			}
		}
	}
	if = {
		limit = {
			has_province_modifier = swe_support_of_the_peasantry_prov
			FROM = { has_country_modifier = swe_support_of_the_peasantry }
			NOT = { owner = { has_country_modifier = swe_support_of_the_peasantry } }
		}
		remove_province_modifier = swe_support_of_the_peasantry_prov
	}
	if = {
		limit = {
			NOT = { has_province_modifier = swe_support_of_the_peasantry_prov }
			owner = { has_country_modifier = swe_support_of_the_peasantry }
			NOT = { FROM = { has_country_modifier = swe_support_of_the_peasantry } }
		}
		hidden_effect = {
			if = {
				limit = {
					OR = {
						trade_goods = grain
						trade_goods = livestock
						trade_goods = fish
					}
				}
				add_province_modifier = { 
					name = swe_support_of_the_peasantry_prov
					duration = -1
					hidden = yes
				}
			}
		}
	}
	if = {
		limit = {
			owner = { has_government_attribute = temples_modifier }
			has_tax_building_trigger = yes
		}
		add_province_modifier = {
			name = gov_expanded_temple_rights_mod
			duration = -1
		}
	}
}

on_trade_good_changed_government_effect = {
	if = {
		limit = {
			owner = { has_reform = monastic_breweries_reform }
		}
		if = {
			limit = {
				trade_goods = grain
			}
			remove_province_modifier = wine_bonus_prod
			add_province_modifier = { 
				name = grain_bonus_prod
				duration = -1
				hidden = yes
			}
		}
		else_if = {
			limit = {
				trade_goods = wine
			}
			remove_province_modifier = wine_bonus_prod
			add_province_modifier = { 
				name = grain_bonus_prod
				duration = -1
				hidden = yes
			}
		}
		else = {
			remove_province_modifier = wine_bonus_prod
			remove_province_modifier = grain_bonus_prod
		}
	}
	else = {
		remove_province_modifier = wine_bonus_prod
		remove_province_modifier = grain_bonus_prod
	}
	if = {
		limit = {
			owner = { has_government_attribute = extra_trade_goods_from_naval_supplies }
		}
		if = {
			limit = {
				trade_goods = naval_supplies
			}
			add_province_modifier = { 
				name = naval_supplies_bonus_prod
				duration = -1
				hidden = yes
			}
		}
		else = {
			remove_province_modifier = naval_supplies_bonus_prod
		}
	}
	else = {
		remove_province_modifier = naval_supplies_bonus_prod
	}
	if = {
		limit = {
			owner = { has_country_modifier = swe_support_of_the_peasantry }
		}
		if = {
			limit = {
				OR = {
					trade_goods = grain
					trade_goods = fish
					trade_goods = livestock
				}
			}
			add_province_modifier = { 
				name = swe_support_of_the_peasantry_prov
				duration = -1
				hidden = yes
			}
		}
		else = {
			remove_province_modifier = swe_support_of_the_peasantry_prov
		}
	}
	else = {
		remove_province_modifier = swe_support_of_the_peasantry_prov
	}
}

#Province effect
judaism_on_province_change_religion_or_change_owner_effect = {
	if = {
		limit = {
			OR = {
				religion_group = christian
				religion_group = muslim
			}
			owner = {
				has_church_aspect = jewish_abrahamic_aspect
			}
		}
		add_province_modifier = {
			name = judaism_abrahamic_roots
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_province_modifier = judaism_abrahamic_roots
			OR = {
				AND = {
					NOT = { religion_group = christian }
					NOT = { religion_group = muslim }
				}
				owner = {
					NOT = { has_church_aspect = jewish_abrahamic_aspect }
				}
			}
		}
		remove_province_modifier = judaism_abrahamic_roots
	}
	if = {
		limit = {
			religion = jewish
			owner = {
				has_church_aspect = judaism_communities_aspect
			}
		}
		if = {
			limit = {
				has_owner_accepted_culture = no
				has_owner_culture = no
				owner = { NOT = { culture_group = ROOT } }
			}
			add_province_modifier = {
				name = judaism_community_wrong_culture
				duration = -1
			}
		}
		else_if = {
			limit = {
				owner = {
					culture_group = ROOT
					has_cultural_union = no
				}
				has_owner_accepted_culture = no
			}
			add_province_modifier = {
				name = judaism_community_same_culture_group
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				NOT = { religion = jewish }
				owner = { NOT = { has_church_aspect = judaism_communities_aspect } }
				has_owner_accepted_culture = yes
				has_owner_culture = yes
			}
			OR = {
				has_province_modifier = judaism_community_wrong_culture
				has_province_modifier = judaism_community_same_culture_group
			}
		}
		if = {
			limit = { has_province_modifier = judaism_community_wrong_culture }
			remove_province_modifier = judaism_community_wrong_culture
		}
		if = {
			limit = { has_province_modifier = judaism_community_same_culture_group }
			remove_province_modifier = judaism_community_same_culture_group
		}
	}
}

#Province effect
judaism_on_province_culture_converted_effect = {
	if = {
		limit = {
			religion = jewish
			owner = {
				has_church_aspect = judaism_communities_aspect
			}
		}
		if = {
			limit = {
				has_owner_accepted_culture = no
				has_owner_culture = no
				owner = { NOT = { culture_group = ROOT } }
			}
			add_province_modifier = {
				name = judaism_community_wrong_culture
				duration = -1
			}
		}
		else_if = {
			limit = {
				owner = {
					culture_group = ROOT
					if = {	#Cultural union
						limit = {
							has_dlc = "Common Sense"
						}
						NOT = { government_rank = 3 }
					}
					else = {
						NOT = { total_development = 1000 }
					}
				}
				has_owner_accepted_culture = no
			}
			add_province_modifier = {
				name = judaism_community_same_culture_group
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				NOT = { religion = jewish }
				owner = { NOT = { has_church_aspect = judaism_communities_aspect } }
				has_owner_accepted_culture = yes
				has_owner_culture = yes
			}
			OR = {
				has_province_modifier = judaism_community_wrong_culture
				has_province_modifier = judaism_community_same_culture_group
			}
		}
		if = {
			limit = { has_province_modifier = judaism_community_wrong_culture }
			remove_province_modifier = judaism_community_wrong_culture
		}
		if = {
			limit = { has_province_modifier = judaism_community_same_culture_group }
			remove_province_modifier = judaism_community_same_culture_group
		}
	}
}

#Country effect
judaism_on_religion_change_effect = {
	every_owned_province = {
		limit = {
			OR = {
				has_province_modifier = judaism_abrahamic_roots
				has_province_modifier = judaism_community_same_culture_group
				has_province_modifier = judaism_community_wrong_culture
			}
		}
		remove_province_modifier = judaism_abrahamic_roots
		remove_province_modifier = judaism_community_same_culture_group
		remove_province_modifier = judaism_community_wrong_culture
	}
}

#Country effect
judaism_on_culture_country_effect = {
	if = {
		limit = {
			has_church_aspect = judaism_communities_aspect
		}
		every_owned_province = {
			remove_province_modifier = judaism_community_wrong_culture
			remove_province_modifier = judaism_community_same_culture_group
		}
		every_owned_province = {
			limit = {
				religion = jewish
			}
			if = {
				limit = {
					NOT = { culture_group = ROOT }
					has_owner_accepted_culture = no
					has_owner_culture = no
				}
				add_province_modifier = {
					name = judaism_community_wrong_culture
					duration = -1
				}
			}
			else_if = {
				limit = {
					owner = {
						has_cultural_union = no
					}
					culture_group = ROOT
					has_owner_accepted_culture = no
				}
				add_province_modifier = {
					name = judaism_community_same_culture_group
					duration = -1
				}
			}
		}
	}
}

#Province effect
imperial_modifiers_on_province_change_culture_or_change_owner_effect = {
	if = {
		limit = {
			NOT = { has_province_modifier = kon_south_african_hegemony_province }
			owner = {
				has_country_modifier = kon_south_african_hegemony
			}
			has_owner_accepted_culture = no
			OR = {
				culture_group = southern_african
				culture_group = african
				culture_group = great_lakes_group
			}
		}
		add_province_modifier = {
			name = kon_south_african_hegemony_province
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_province_modifier = kon_south_african_hegemony_province
		}
		remove_province_modifier = kon_south_african_hegemony_province
	}
	if = {
		limit = {
			NOT = { has_province_modifier = nor_scandinavian_empire_local }
			owner = {
				has_country_modifier = nor_scandinavian_empire
			}
			culture_group = scandinavian
		}
		add_province_modifier = {
			name = nor_scandinavian_empire_local
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_province_modifier = nor_scandinavian_empire_local
		}
		remove_province_modifier = nor_scandinavian_empire_local
	}
	if = {
		limit = {
			NOT = { has_province_modifier = sca_hegemony_over_germany_province }
			owner = {
				has_country_modifier = sca_hegemony_over_germany
				NOT = { culture_group = PREV }
				NOT = { primary_culture = PREV }
			}
			culture_group = germanic
			has_owner_accepted_culture = no
		}
		add_province_modifier = {
			name = sca_hegemony_over_germany_province
			duration = -1
		}
	}
	else_if = {
		limit = {
			NOT = { has_province_modifier = sca_hegemony_over_germany_province_same_culture }
			owner = {
				has_country_modifier = sca_hegemony_over_germany
				culture_group = PREV
				NOT = { primary_culture = PREV }
			}
			culture_group = germanic
			has_owner_accepted_culture = no
		}
		add_province_modifier = {
			name = sca_hegemony_over_germany_province_same_culture
			duration = -1
		}
	}
	else_if = {
		limit = {
			OR = {
				has_province_modifier = sca_hegemony_over_germany_province
				has_province_modifier = sca_hegemony_over_germany_province_same_culture
			}
		}
		remove_province_modifier = sca_hegemony_over_germany_province
		remove_province_modifier = sca_hegemony_over_germany_province_same_culture
	}
}

#Country effect
imperial_modifiers_on_culture_country_effect = {
	every_owned_province = {
		remove_province_modifier = kon_south_african_hegemony_province
		remove_province_modifier = nor_scandinavian_empire_local
		remove_province_modifier = sca_hegemony_over_germany_province
		remove_province_modifier = sca_hegemony_over_germany_province_same_culture
	}
	if = {
		limit = {
			has_country_modifier = kon_south_african_hegemony
		}
		every_owned_province = {
			limit = {
				OR = {
					culture_group = southern_african
					culture_group = african
					culture_group = great_lakes_group
				}
				NOT = { has_province_modifier = kon_south_african_hegemony_province }
				has_owner_accepted_culture = no
			}
			add_province_modifier = {
				name = kon_south_african_hegemony_province
				duration = -1
			}
		}
	}
	if = {
		limit = {
			has_country_modifier = sca_hegemony_over_germany
		}
		every_owned_province = {
			limit = {
				culture_group = germanic
				NOT = { has_province_modifier = sca_hegemony_over_germany_province }
				has_owner_accepted_culture = no
				owner = {
					NOT = { primary_culture = PREV }
					NOT = { culture_group = PREV }
				}
			}
			add_province_modifier = {
				name = sca_hegemony_over_germany_province
				duration = -1
			}
		}
		every_owned_province = {
			limit = {
				culture_group = germanic
				NOT = { has_province_modifier = sca_hegemony_over_germany_province_same_culture }
				has_owner_accepted_culture = no
				owner = {
					NOT = { primary_culture = PREV }
					culture_group = PREV
				}
			}
			add_province_modifier = {
				name = sca_hegemony_over_germany_province_same_culture
				duration = -1
			}
		}
	}
	if = {
		limit = {
			has_country_modifier = nor_scandinavian_empire
		}
		every_owned_province = {
			limit = {
				culture_group = scandinavian
				NOT = { has_province_modifier = nor_scandinavian_empire_local }
			}
			add_province_modifier = {
				name = nor_scandinavian_empire_local
				duration = -1
			}
		}
	}
}

#Country effect
imperial_modifiers_on_primary_culture_change_effect = {
	if = {
		limit = {
			has_country_modifier = kon_south_african_hegemony
			NOT = { culture_group = kongo_group }
		}
		remove_country_modifier = kon_south_african_hegemony
		every_owned_province = {
			limit = {
				has_province_modifier = kon_south_african_hegemony_province
			}
			remove_province_modifier = kon_south_african_hegemony_province
		}
	}
	every_owned_province = {
		remove_province_modifier = sca_hegemony_over_germany_province
		remove_province_modifier = sca_hegemony_over_germany_province_same_culture
	}
	if = {
		limit = {
			has_country_modifier = sca_hegemony_over_germany
		}
		every_owned_province = {
			limit = {
				culture_group = germanic
				NOT = { has_province_modifier = sca_hegemony_over_germany_province }
				has_owner_accepted_culture = no
				owner = {
					NOT = { primary_culture = PREV }
					NOT = { culture_group = PREV }
				}
			}
			add_province_modifier = {
				name = sca_hegemony_over_germany_province
				duration = -1
			}
		}
		every_owned_province = {
			limit = {
				culture_group = germanic
				NOT = { has_province_modifier = sca_hegemony_over_germany_province_same_culture }
				has_owner_accepted_culture = no
				owner = {
					NOT = { primary_culture = PREV }
					culture_group = PREV
				}
			}
			add_province_modifier = {
				name = sca_hegemony_over_germany_province_same_culture
				duration = -1
			}
		}
	}
	if = {
		limit = {
			has_country_modifier = nor_scandinavian_empire
			NOT = { culture_group = scandinavian }
		}
		remove_country_modifier = nor_scandinavian_empire
		every_owned_province = {
			limit = {
				has_province_modifier = nor_scandinavian_empire_local
			}
			remove_province_modifier = nor_scandinavian_empire_local
		}
	}
}
